generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CHITIETGIOHANG {
  MaCTGH         String         @id @default(uuid())
  created_at     DateTime       @default(now())
  SoLuong        Int            @default(0)
  MaGH           String
  MaCTSP         String

  GIOHANG        GIOHANG        @relation(fields: [MaGH], references: [MaGH])
  CHITIETSANPHAM CHITIETSANPHAM @relation(fields: [MaCTSP], references: [MaCTSP])
}

model CHITIETSANPHAM {
  MaCTSP         String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  KichCo         KichCo
  MaSP           String
  SoLuong        Int              @default(0)
  TrangThaiSP      TrangThaiSP    @default(CON_HANG)

  SANPHAM        SANPHAM          @relation(fields: [MaSP], references: [MaSP])
  CHITIETGIOHANG CHITIETGIOHANG[]
  DONHANG        DONHANG[]
  PHIEUNHAPHANG  PHIEUNHAPHANG[]
}

model DANHMUC {
  MaDM        String      @id @default(uuid())
  created_at  DateTime    @default(now())
  updated_at  DateTime    @default(now())
  TenDM       String
  TrangThai   TrangThai   @default(ACTIVE)
  Loai        LoaiDanhMuc @map("LoaiDanhMuc") 
  SANPHAM     SANPHAM[]
}

model DONHANG {
  MaDH             String             @id @default(uuid())
  created_at       DateTime           @default(now())
  SoLuong          Int                @default(0)
  TongTien         Int?
  MaVoucher        String?
  MaCTSP           String
  MaSK             String?
  MaTK_KH          String?             
  CHITIETSANPHAM   CHITIETSANPHAM     @relation(fields: [MaCTSP], references: [MaCTSP])
  KHACHHANG_ACCOUNT TAIKHOAN?         @relation("DonHang_KhachAccount", fields: [MaTK_KH], references: [MaTK])
  SUKIENUUDAI      SUKIENUUDAI?       @relation(fields: [MaSK], references: [MaSK])
  VOUCHER          VOUCHER?           @relation(fields: [MaVoucher], references: [MaVoucher])
  TINHTRANGDONHANG TINHTRANGDONHANG[]
}

model GIOHANG {
  MaGH           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  MaTKKH         String?          
  
  TAIKHOAN      TAIKHOAN?       @relation(fields: [MaTKKH], references: [MaTK])
  CHITIETGIOHANG CHITIETGIOHANG[]
}


model NHACUNGCAP {
  MaNCC      String     @id @default(uuid())
  created_at DateTime   @default(now())
  Email      String?
  DienThoai  String?
  DiaChi     String?
  TenNCC     String
  PHIEUNHAPHANG PHIEUNHAPHANG[] 
}

model PHANHOI {
  MaPH           String    @id @default(uuid())
  created_at     DateTime  @default(now())
  updated_at     DateTime  @default(now())
  NoiDung        String
  MaTKKH         String
  MaSP           String
  SoSao          Int
  BinhLuan       String?

  TAIKHOAN       TAIKHOAN  @relation(fields: [MaTKKH], references: [MaTK])
  SANPHAM        SANPHAM   @relation(fields: [MaSP], references: [MaSP])
}


model SANPHAM {
  MaSP           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  MoTa           String?
  TenSP          String
  HinhAnh        String[]
  GiaBan         Int
  GiaMua         Int
  TrangThai      TrangThai        @default(ACTIVE)
  MaDM           String
  MauSac         MauSac
  DANHMUC        DANHMUC          @relation(fields: [MaDM], references: [MaDM])
  CHITIETSANPHAM CHITIETSANPHAM[]
  PHANHOI        PHANHOI[]
}

model SUKIENUUDAI {
  MaSK         String    @id @default(uuid())
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now())
  NgayKT       DateTime
  TenSK        String
  NgayPH       DateTime
  PhanTramGiam Int
  TrangThai    TrangThai @default(ACTIVE)
  MoTa         String?
  DONHANG      DONHANG[]
}

model TAIKHOAN {
  MaTK       String      @id @default(uuid())
  created_at DateTime    @default(now())
  updated_at DateTime    @default(now())
  Username   String?     @unique
  MatKhau    String?
  Status     TrangThai     @default(ACTIVE)
  Avatar     String?
  GIOHANG    GIOHANG[]
  PHANHOI    PHANHOI[]
  DONHANG    DONHANG[]    @relation("DonHang_KhachAccount")
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
  PhieuNhapNVQL PHIEUNHAPHANG[] @relation("PhieuNhap_NVQL")
  PhieuNhapNVXN PHIEUNHAPHANG[] @relation("PhieuNhap_NVXN")
  VAITRO     VaiTro
}

model TINHTRANGDONHANG {
  MaTTDH     String           @id @default(uuid())
  created_at DateTime         @default(now())
  TrangThai  TrangThaiDonHang @default(DANG_XU_LY)
  MaDH       String?
  DONHANG    DONHANG?         @relation(fields: [MaDH], references: [MaDH])
}

model VOUCHER {
  MaVoucher         String              @id @default(uuid())
  created_at        DateTime            @default(now())
  TenVoucher        String
  SoTien            Int                 @default(0)
  FreeShip          Boolean             @default(false)
  NgayBatDau        DateTime
  NgayKetThuc       DateTime
  Dieukien          Int                 @default(0)
  TrangThai    TrangThai @default(ACTIVE)
  MoTa         String?
  DONHANG           DONHANG[]
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
}

model VOUCHER_KHACHHANG {
  MaVCKH     String    @id @default(uuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  TrangThai  TrangThai @default(ACTIVE)
  MaTKKH       String
  MaVoucher  String

  TAIKHOAN  TAIKHOAN @relation(fields: [MaTKKH], references: [MaTK])
  VOUCHER    VOUCHER   @relation(fields: [MaVoucher], references: [MaVoucher])
}

model PHIEUNHAPHANG {
  MaPNH     String    @id @default(uuid())
  created_at  DateTime  @default(now())
  SoLuong    Int
  MaCTSP     String
  MaNCC      String
  TrangThai  TrangThaiPhieuNhapHang
  MaTKNVQL   String?
  MaTKNVXN   String?
  NoiDung    String

  CHITIETSANPHAM CHITIETSANPHAM? @relation(fields: [MaCTSP], references: [MaCTSP])
  NHACUNGCAP     NHACUNGCAP?     @relation(fields: [MaNCC], references: [MaNCC])
  TaiKhoanNVQL   TAIKHOAN?       @relation("PhieuNhap_NVQL", fields: [MaTKNVQL], references: [MaTK])
  TaiKhoanNVXN   TAIKHOAN?       @relation("PhieuNhap_NVXN", fields: [MaTKNVXN], references: [MaTK])
}


enum KichCo {
  S
  M
  L
  XL
  XXL
}



enum MauSac {
  Red
  Orange
  Yellow
  Green
  Blue
  Indigo
  Violet
  Black
  White
  Gray
  Brown
  Pink
}

enum TrangThai {
  ACTIVE
  INACTIVE
}

enum TrangThaiDonHang {
  DANG_XU_LY
  DANG_GIAO_HANG
  HOAN_TAT
  HUY
}

enum TrangThaiSP {
  CON_HANG
  HET_HANG
  TAM_NGUNG
}

enum LoaiDanhMuc {
  NAM
  NU
  PHU_KIEN
}

enum TrangThaiPhieuNhapHang {
  DANG_CHO
  NCC_XACNHAN
  NV_XACNHAN
  TU_CHOI
}

enum VaiTro {
  KH
  NCC
  QLDN
  NVVH  
  NVCSKH
  ADMIN
}




