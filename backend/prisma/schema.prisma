generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CHITIETGIOHANG {
  MaCTGH         String         @id @default(uuid())
  created_at     DateTime       @default(now())
  SoLuong        Int            @default(0)
  MaGH           String
  MaCTSP         String

  GIOHANG        GIOHANG        @relation(fields: [MaGH], references: [MaGH])
  CHITIETSANPHAM CHITIETSANPHAM @relation(fields: [MaCTSP], references: [MaCTSP])
}

model CHITIETSANPHAM {
  MaCTSP         String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  KichCo         KichCo
  MauSac         MauSac
  HinhAnh        String?
  MaSP           String
  SoLuong        Int              @default(0)
  TrangThaiSP      TrangThaiSP    @default(CON_HANG)

  SANPHAM        SANPHAM          @relation(fields: [MaSP], references: [MaSP])
  CHITIETGIOHANG CHITIETGIOHANG[]
  DONHANG        DONHANG[]
  PHIEUNHAPHANG  PHIEUNHAPHANG[]
}

model DANHMUC {
  MaDM        String      @id @default(uuid())
  created_at  DateTime    @default(now())
  updated_at  DateTime    @default(now())
  TenDM       String
  TrangThai   TrangThai   @default(ACTIVE)
  Loai        LoaiDanhMuc @map("LoaiDanhMuc") 
  SANPHAM     SANPHAM[]
}

model DONHANG {
  MaDH             String             @id @default(uuid())
  created_at       DateTime           @default(now())
  SoLuong          Int                @default(0)
  TongTien         Int?
  MaVoucher        String?
  MaCTSP           String
  MaSK             String?
  MaTK_KH          String?             
  CHITIETSANPHAM   CHITIETSANPHAM     @relation(fields: [MaCTSP], references: [MaCTSP])
  KHACHHANG_ACCOUNT TAIKHOAN?         @relation("DonHang_KhachAccount", fields: [MaTK_KH], references: [MaTK])
  SUKIENUUDAI      SUKIENUUDAI?       @relation(fields: [MaSK], references: [MaSK])
  VOUCHER          VOUCHER?           @relation(fields: [MaVoucher], references: [MaVoucher])
  TINHTRANGDONHANG TINHTRANGDONHANG[]
}

model GIOHANG {
  MaGH           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  MaTKKH         String?          
  
  TAIKHOAN      TAIKHOAN?       @relation(fields: [MaTKKH], references: [MaTK])
  CHITIETGIOHANG CHITIETGIOHANG[]
}

model KHACHHANG {
  MaKH              String        @id @default(uuid())
  TenKH             String
  SoDienThoai       String
  Email             String?
  DiaChi            String?
  MaTK              String?   @unique          
  TAIKHOAN          TAIKHOAN? @relation("KhachHang_TaiKhoan", fields: [MaTK], references: [MaTK])
}

model NHACUNGCAP {
  MaNCC      String     @id @default(uuid())
  created_at DateTime   @default(now())
  Email      String?
  DienThoai  String?
  DiaChi     String?
  TenNCC     String
  PHIEUNHAPHANG PHIEUNHAPHANG[] 
}

model NHANVIEN {
  MaNV        String    @id @default(uuid())
  MaNVQL      String?          
  TenNV       String
  SoDienThoai String?
  Email       String?
  CCCD        String?
  MaTK        String?
  TAIKHOAN    TAIKHOAN? @relation(fields: [MaTK], references: [MaTK])
  QuanLy      NHANVIEN?  @relation("QuanLy", fields: [MaNVQL], references: [MaNV])
  NhanVienQL  NHANVIEN[] @relation("QuanLy")
}

model PHANHOI {
  MaPH           String    @id @default(uuid())
  created_at     DateTime  @default(now())
  MaTKKH         String
  MaSP           String
  DanhGia        String
  ChiTietDanhGia String?

  TAIKHOAN       TAIKHOAN  @relation(fields: [MaTKKH], references: [MaTK])
  SANPHAM        SANPHAM   @relation(fields: [MaSP], references: [MaSP])
}


model SANPHAM {
  MaSP           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  MoTa           String?
  TenSP          String
  GiaBan         Int
  GiaMua         Int
  TrangThaiSP      TrangThaiSP        @default(CON_HANG)
  MaDM           String

  DANHMUC        DANHMUC          @relation(fields: [MaDM], references: [MaDM])
  CHITIETSANPHAM CHITIETSANPHAM[]
  PHANHOI        PHANHOI[]
}

model SUKIENUUDAI {
  MaSK         String    @id @default(uuid())
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now())
  NgayKT       DateTime
  TenSK        String
  NgayPH       DateTime
  PhanTramGiam Int
  DONHANG      DONHANG[]
}

model TAIKHOAN {
  MaTK       String      @id @default(uuid())
  created_at DateTime    @default(now())
  updated_at DateTime    @default(now())
  Username   String?     @unique
  MatKhau    String?
  Status     Boolean     @default(true)
  Avatar     String?
  NHANVIEN   NHANVIEN[]
  GIOHANG    GIOHANG[]
  PHANHOI    PHANHOI[]
  DONHANG    DONHANG[]    @relation("DonHang_KhachAccount")
  KHACHHANG  KHACHHANG? @relation("KhachHang_TaiKhoan")
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
  PhieuNhapNVQL PHIEUNHAPHANG[] @relation("PhieuNhap_NVQL")
  PhieuNhapNVXN PHIEUNHAPHANG[] @relation("PhieuNhap_NVXN")
  VAITRO     VaiTro
  
}

model TINHTRANGDONHANG {
  MaTTDH     String           @id @default(uuid())
  created_at DateTime         @default(now())
  TrangThai  TrangThaiDonHang @default(DANG_XU_LY)
  MaDH       String?
  DONHANG    DONHANG?         @relation(fields: [MaDH], references: [MaDH])
}

model VOUCHER {
  MaVoucher         String              @id @default(uuid())
  created_at        DateTime            @default(now())
  TenVoucher        String
  SoTien            Int                 @default(0)
  FreeShip          Boolean             @default(false)
  NgayBatDau        DateTime
  NgayKetThuc       DateTime
  Dieukien          Int                 @default(0)

  DONHANG           DONHANG[]
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
}

model VOUCHER_KHACHHANG {
  MaVCKH     String    @id @default(uuid())
  created_at DateTime  @default(now())
  MaTKKH       String
  MaVoucher  String

  TAIKHOAN  TAIKHOAN @relation(fields: [MaTKKH], references: [MaTK])
  VOUCHER    VOUCHER   @relation(fields: [MaVoucher], references: [MaVoucher])
}

model PHIEUNHAPHANG {
  MaPNNH     String    @id @default(uuid())
  timestamp  DateTime  @default(now())
  SoLuong    Int
  MaCTSP     String
  MaNCC      String
  TrangThai  TrangThaiPhieuNhapHang
  MaTKNVQL   String?
  MaTKNVXN   String?

  CHITIETSANPHAM CHITIETSANPHAM? @relation(fields: [MaCTSP], references: [MaCTSP])
  NHACUNGCAP     NHACUNGCAP?     @relation(fields: [MaNCC], references: [MaNCC])
  TaiKhoanNVQL   TAIKHOAN?       @relation("PhieuNhap_NVQL", fields: [MaTKNVQL], references: [MaTK])
  TaiKhoanNVXN   TAIKHOAN?       @relation("PhieuNhap_NVXN", fields: [MaTKNVXN], references: [MaTK])
}


enum KichCo {
  S
  M
  L
  XL
  XXL
}

enum MauSac {
  Red
  Orange
  Yellow
  Green
  Blue
  Indigo
  Violet
  Black
  White
  Gray
  Brown
  Pink
}

enum TrangThai {
  ACTIVE
  INACTIVE
}

enum TrangThaiDonHang {
  DANG_XU_LY
  DANG_GIAO_HANG
  HOAN_TAT
}

enum TrangThaiSP {
  CON_HANG
  HET_HANG
  TAM_NGUNG
}

enum LoaiDanhMuc {
  NAM
  NU
  PHU_KIEN
}

enum TrangThaiPhieuNhapHang {
  DANG_CHO
  NCC_XACNHAN
  LOGISTIC_XACNHAN
  TU_CHOI
}

enum VaiTro {
  KH
  NCC
  QLDN
  QLLOGISTIC
  NVVH
}


// VIEW: vw_chi_tiet_san_pham
model VWChiTietSanPham {
  MaCTSP            String @id
  MaSP              String
  TenSP             String
  GiaBan            Int
  KichCo            String
  MauSac            String
  SoLuong           Int
  TonKho            Int?   @map("ton_kho")
  TongTienBan       Int?   @map("tong_tien_ban")
  NgayNhapMoiNhat   DateTime? @map("ngay_nhap_moi_nhat")
  MaDM              String
  TenDM             String

  @@map("vw_chi_tiet_san_pham")
  @@ignore
}

// VIEW: vw_chi_tiet_don_hang
model VWChiTietDonHang {
  id               String   @id @default(uuid()) // tạo id giả định
  MaDH             String
  MaCTSP           String
  CreatedAt        DateTime @map("created_at")
  MaSP             String
  TenSP            String
  SoLuong          Int
  TongTienDon      Int?      @map("tong_tien_don")
  MaVoucher        String?
  TenVoucher       String?
  SoTienVoucher    Int?
  MaSK             String?
  TenSK            String?
  PhanTramGiam     Int?
  MaDM             String
  TenDM            String
  TrangThai        String?

  @@map("vw_chi_tiet_don_hang")
  @@ignore
}

// VIEW: vw_nhap_hang_chi_tiet
model VWNhapHangChiTiet {
  id           String   @id @default(uuid()) // tạo id giả định
  MaPNNH       String
  MaCTSP       String
  CreatedAt    DateTime @map("created_at")
  SoLuong      Int
  MaNCC        String
  TenNCC       String
  MaSP         String
  TenSP        String
  TongDaNhap   Int? @map("tong_da_nhap")

  @@map("vw_nhap_hang_chi_tiet")
  @@ignore
}

// VIEW: vw_khach_hang_tai_khoan
model VWKhachHangTaiKhoan {
  id              String   @id @default(uuid()) // tạo id giả định
  MaKH            String
  MaDH            String?
  MaCTSP          String?
  TenKH           String
  SoDienThoai     String
  Email           String?
  DiaChi          String?
  MaTK            String?
  Username        String?
  Avatar          String?
  Status          Boolean?
  MaGH            String?
  TongSoLuongGio  Int? @map("tong_so_luong_gio")
  CreatedAtDon    DateTime? @map("created_at")
  MaSP            String?
  TenSPDon        String? @map("TenSP")
  SoLuongDon      Int? @map("SoLuong")
  TongTienDon     Int? @map("tong_tien_don")
  TrangThai       String?
  MaVoucher       String?
  TenVoucher      String?

  @@map("vw_khach_hang_tai_khoan")
  @@ignore
}

// VIEW: vw_nhan_vien_tai_khoan
model VWNhanVienTaiKhoan {
  MaNV      String @id
  TenNV     String
  Username  String?
  VaiTro    VaiTro

  @@map("vw_nhan_vien_tai_khoan")
  @@ignore
}

