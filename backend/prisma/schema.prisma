generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CHITIETGIOHANG {
  MaCTGH         String         @id @default(uuid())
  created_at     DateTime       @default(now())
  SoLuong        Int            @default(0)
  MaGH           String
  MaCTSP         String

  GIOHANG        GIOHANG        @relation(fields: [MaGH], references: [MaGH])
  CHITIETSANPHAM CHITIETSANPHAM @relation(fields: [MaCTSP], references: [MaCTSP])
}

model CHITIETSANPHAM {
  MaCTSP         String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  KichCo         KichCo
  MauSac         MauSac
  HinhAnh        String?
  MaSP           String
  SoLuong        Int              @default(0)
  TrangThaiSP      TrangThaiSP    @default(CON_HANG)

  SANPHAM        SANPHAM          @relation(fields: [MaSP], references: [MaSP])
  CHITIETGIOHANG CHITIETGIOHANG[]
  DONHANG        DONHANG[]
  PHIEUNHAPHANG  PHIEUNHAPHANG[]
}

model DANHMUC {
  MaDM        String      @id @default(uuid())
  created_at  DateTime    @default(now())
  updated_at  DateTime    @default(now())
  TenDM       String
  TrangThai   TrangThai   @default(ACTIVE)
  Loai        LoaiDanhMuc @map("LoaiDanhMuc") 
  SANPHAM     SANPHAM[]
}

model DONHANG {
  MaDH             String             @id @default(uuid())
  created_at       DateTime           @default(now())
  SoLuong          Int                @default(0)
  TongTien         Int?
  MaVoucher        String?
  MaCTSP           String
  MaSK             String?
  MaTK_KH          String?             
  CHITIETSANPHAM   CHITIETSANPHAM     @relation(fields: [MaCTSP], references: [MaCTSP])
  KHACHHANG_ACCOUNT TAIKHOAN?         @relation("DonHang_KhachAccount", fields: [MaTK_KH], references: [MaTK])
  SUKIENUUDAI      SUKIENUUDAI?       @relation(fields: [MaSK], references: [MaSK])
  VOUCHER          VOUCHER?           @relation(fields: [MaVoucher], references: [MaVoucher])
  TINHTRANGDONHANG TINHTRANGDONHANG[]
}

model GIOHANG {
  MaGH           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  MaTKKH         String?          
  
  TAIKHOAN      TAIKHOAN?       @relation(fields: [MaTKKH], references: [MaTK])
  CHITIETGIOHANG CHITIETGIOHANG[]
}


model NHACUNGCAP {
  MaNCC      String     @id @default(uuid())
  created_at DateTime   @default(now())
  Email      String?
  DienThoai  String?
  DiaChi     String?
  TenNCC     String
  PHIEUNHAPHANG PHIEUNHAPHANG[] 
}

model PHANHOI {
  MaPH           String    @id @default(uuid())
  created_at     DateTime  @default(now())
  MaTKKH         String
  MaSP           String
  DanhGia        String
  ChiTietDanhGia String?

  TAIKHOAN       TAIKHOAN  @relation(fields: [MaTKKH], references: [MaTK])
  SANPHAM        SANPHAM   @relation(fields: [MaSP], references: [MaSP])
}


model SANPHAM {
  MaSP           String           @id @default(uuid())
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now())
  MoTa           String?
  TenSP          String
  GiaBan         Int
  GiaMua         Int
  TrangThai      TrangThai        @default(ACTIVE)
  MaDM           String

  DANHMUC        DANHMUC          @relation(fields: [MaDM], references: [MaDM])
  CHITIETSANPHAM CHITIETSANPHAM[]
  PHANHOI        PHANHOI[]
}

model SUKIENUUDAI {
  MaSK         String    @id @default(uuid())
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now())
  NgayKT       DateTime
  TenSK        String
  NgayPH       DateTime
  PhanTramGiam Int
  TrangThai    TrangThai @default(ACTIVE)
  MoTa         String?
  DONHANG      DONHANG[]
}

model TAIKHOAN {
  MaTK       String      @id @default(uuid())
  created_at DateTime    @default(now())
  updated_at DateTime    @default(now())
  Username   String?     @unique
  MatKhau    String?
  Status     TrangThai     @default(ACTIVE)
  Avatar     String?
  GIOHANG    GIOHANG[]
  PHANHOI    PHANHOI[]
  DONHANG    DONHANG[]    @relation("DonHang_KhachAccount")
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
  PhieuNhapNVQL PHIEUNHAPHANG[] @relation("PhieuNhap_NVQL")
  PhieuNhapNVXN PHIEUNHAPHANG[] @relation("PhieuNhap_NVXN")
  VAITRO     VaiTro
}

model TINHTRANGDONHANG {
  MaTTDH     String           @id @default(uuid())
  created_at DateTime         @default(now())
  TrangThai  TrangThaiDonHang @default(DANG_XU_LY)
  MaDH       String?
  DONHANG    DONHANG?         @relation(fields: [MaDH], references: [MaDH])
}

model VOUCHER {
  MaVoucher         String              @id @default(uuid())
  created_at        DateTime            @default(now())
  TenVoucher        String
  SoTien            Int                 @default(0)
  FreeShip          Boolean             @default(false)
  NgayBatDau        DateTime
  NgayKetThuc       DateTime
  Dieukien          Int                 @default(0)
  TrangThai    TrangThai @default(ACTIVE)
  MoTa         String?
  DONHANG           DONHANG[]
  VOUCHER_KHACHHANG VOUCHER_KHACHHANG[]
}

model VOUCHER_KHACHHANG {
  MaVCKH     String    @id @default(uuid())
  created_at DateTime  @default(now())
  MaTKKH       String
  MaVoucher  String

  TAIKHOAN  TAIKHOAN @relation(fields: [MaTKKH], references: [MaTK])
  VOUCHER    VOUCHER   @relation(fields: [MaVoucher], references: [MaVoucher])
}

model PHIEUNHAPHANG {
  MaPNNH     String    @id @default(uuid())
  timestamp  DateTime  @default(now())
  SoLuong    Int
  MaCTSP     String
  MaNCC      String
  TrangThai  TrangThaiPhieuNhapHang
  MaTKNVQL   String?
  MaTKNVXN   String?

  CHITIETSANPHAM CHITIETSANPHAM? @relation(fields: [MaCTSP], references: [MaCTSP])
  NHACUNGCAP     NHACUNGCAP?     @relation(fields: [MaNCC], references: [MaNCC])
  TaiKhoanNVQL   TAIKHOAN?       @relation("PhieuNhap_NVQL", fields: [MaTKNVQL], references: [MaTK])
  TaiKhoanNVXN   TAIKHOAN?       @relation("PhieuNhap_NVXN", fields: [MaTKNVXN], references: [MaTK])
}


enum KichCo {
  S
  M
  L
  XL
  XXL
}

enum MauSac {
  Red
  Orange
  Yellow
  Green
  Blue
  Indigo
  Violet
  Black
  White
  Gray
  Brown
  Pink
}

enum TrangThai {
  ACTIVE
  INACTIVE
}

enum TrangThaiDonHang {
  DANG_XU_LY
  DANG_GIAO_HANG
  HOAN_TAT
}

enum TrangThaiSP {
  CON_HANG
  HET_HANG
  TAM_NGUNG
}

enum LoaiDanhMuc {
  NAM
  NU
  PHU_KIEN
}

enum TrangThaiPhieuNhapHang {
  DANG_CHO
  NCC_XACNHAN
  LOGISTIC_XACNHAN
  TU_CHOI
}

enum VaiTro {
  KH
  NCC
  QLDN
  QLLOGISTIC
  NVVH
}



model VWChiTietSanPham {
  MaCTSP          String   @id
  MaSP            String
  TenSP           String
  GiaBan          Int
  KichCo          String
  MauSac          String
  SoLuong         Int
  TonKho          Int?      @map("ton_kho")
  TongDaBan       Int?      @map("tong_da_ban")
  NgayNhapMoiNhat DateTime? @map("ngay_nhap_moi_nhat")
  MaDM            String
  TenDM           String

  @@map("vw_chi_tiet_san_pham")
  @@ignore
}

model VWChiTietDonHang {
  id            String   @id @default(uuid()) 
  MaDH          String
  CreatedAt     DateTime @map("created_at")
  MaCTSP        String
  MaSP          String
  TenSP         String
  SoLuong       Int
  TongTienDon   Int?      @map("tong_tien_don")
  MaVoucher     String?
  TenVoucher    String?
  SoTienVoucher Int?      @map("SoTien")
  MaSK          String?
  TenSK         String?
  PhanTramGiam  Int?
  MaDM          String
  TenDM         String
  TrangThai     String?
  MaTK_KH       String?

  @@map("vw_chi_tiet_don_hang")
  @@ignore
}

model VWNhapHangChiTiet {
  id          String   @id @default(uuid()) 
  MaPNNH      String
  CreatedAt   DateTime @map("created_at")
  SoLuong     Int
  MaNCC       String
  TenNCC      String
  MaCTSP      String
  MaSP        String
  TenSP       String
  TongDaNhap  Int?     @map("tong_da_nhap")

  @@map("vw_nhap_hang_chi_tiet")
  @@ignore
}


model VWKhachHangTaiKhoan {
  id             String   @id @default(uuid()) 
  MaTK           String
  Username       String?
  Avatar         String?
  Status         Boolean?
  VaiTro         VaiTro   @map("VAITRO")
  MaGH           String?
  TongSoLuongGio Int?     @map("tong_so_luong_gio")
  MaDH           String?
  NgayDat        DateTime? @map("ngay_dat")
  MaCTSP         String?
  MaSP           String?
  TenSP          String?
  SoLuong        Int?
  TongTienDon    Int?     @map("tong_tien_don")
  TrangThaiDon   String?  @map("trang_thai_don")
  MaVoucher      String?
  TenVoucher     String?

  @@map("vw_khach_hang_tai_khoan")
  @@ignore
}


model VWNhanVienTaiKhoan {
  MaTK      String @id
  Username  String?
  Avatar    String?
  Status    Boolean?
  VaiTro    VaiTro  @map("VAITRO")

  @@map("vw_nhan_vien_tai_khoan")
  @@ignore
}